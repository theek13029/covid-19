<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:h="http://xmlns.jcp.org/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:f="http://xmlns.jcp.org/jsf/core">

<body>

  <ui:composition template="/template1.xhtml">
    <ui:define name="title">
     Lab | Search
    </ui:define>
    <ui:define name="content">
      <div class="row bg-white py-4">
        <div class="mb-2">
          <h4 class="fw-bold text-center">Search Lab Samples</h4>
        </div>
        <div class="col-md-3">
          <label for="fromDate" class="form-label d-block fw-bold">From Date</label>
          <p:calendar id="fromDate" class="form-select" value="#{clientController.fromDate}"
                      pattern="dd MMMM yyyy hh:mm a">
          </p:calendar>
        </div>
        <div class="col-md-3">
          <label for="toDate" class="form-label fw-bold">To Date</label>
          <p:calendar id="toDate" class="form-select" value="#{clientController.toDate}"
                      pattern="dd MMMM yyyy hh:mm a">
          </p:calendar>
        </div>
        <div class="col-md-3">
          <h:form>
            <label for="txtSearchName" class="form-label fw-bold">Search By Name</label>
            <div class="input-group">
              <h:inputText class="form-control" id="txtSearchName" required="true"
                requiredMessage="Please enter a name to search" value="#{clientController.searchingName}">
              </h:inputText>
              <h:commandButton class="btn btn-success fw-bold" value="Search"
                action="#{clientController.searchByName()}">
              </h:commandButton>
            </div>
            <h:messages class="small text-danger" for="txtSearchName"></h:messages>
          </h:form>
        </div>
        <div class="col-md-3">
          <h:form>
            <label for="txtSearchId" class="form-label fw-bold">Search By Test Id</label>
            <div class="input-group">
              <h:inputText class="form-control" id="txtSearchId" required="true"
                requiredMessage="Please enter ad ID to search" value="#{clientController.searchingTestId}">
              </h:inputText>
              <h:commandButton class="btn btn-success fw-bold" value="Search"
                action="#{clientController.searchByTestId()}">
              </h:commandButton>
            </div>
            <h:messages class="text-danger small" for="txtSearchId"></h:messages>
          </h:form>
        </div>
        <div class="col-md-3">
          <h:form>
            <label for="txtSearchTestNo" class="form-label fw-bold">Search By Test | Tube | Sample #</label>
            <div class="input-group">
              <h:inputText class="form-control" id="txtSearchTestNo" required="true"
                requiredMessage="Please enter a Test number to search" value="#{clientController.searchingTestNo}">
              </h:inputText>
              <h:commandButton class="btn btn-success fw-bold" value="Search" action="#{clientController.searchByTestNo()}">
              </h:commandButton>
            </div>
            <h:messages class="text-danger small" for="txtSearchTestNo"></h:messages>

          </h:form>
        </div>
        <div class="col-md-3">
          <h:form>
            <label for="txtSearchBhtNo" class="form-label fw-bold">Search By BHT #</label>
            <div class="input-group">
              <h:inputText class="form-control " id="txtSearchBhtNo" required="true"
                requiredMessage="Please enter a BHT number to search" value="#{clientController.searchingBhtno}">
              </h:inputText>
              <h:commandButton class="btn btn-success fw-bold" value="Search"
                action="#{clientController.searchByBhtNo()}">
              </h:commandButton>
            </div>
            <h:messages class="text-danger small" for="txtSearchBhtNo"></h:messages>
          </h:form>
        </div>
        <div class="col-md-3">
          <h:form>
            <label for="txtSearchByLabNo" class="form-label fw-bold">Search By Lab #</label>
            <div class="input-group">
              <h:inputText class="form-control fs-6" id="txtSearchByLabNo" required="true"
                requiredMessage="Please enter a Test number to search" value="#{clientController.searchingLabNo}">
              </h:inputText>
              <h:commandButton class="btn btn-success fw-bold" value="Search"
                action="#{clientController.searchByLabNo()}">
              </h:commandButton>
            </div>

            <h:messages class="text-danger small" for="txtSearchByLabNo"></h:messages>

          </h:form>
        </div>
      </div>
      <div class="my-3">
        <div>
          <p:commandButton class="btn btn-secondary btn-sm" id="toggler" type="button" value="Columns" icon="pi pi-align-justify" />
          <p:columnToggler datasource="tbl" trigger="toggler" />
        </div>
        <p:dataTable id="tbl" value="#{clientController.testList}"
          class="table"
          rowIndexVar="n"
          rowKey="#{c.id}"
          var="c" rows="10"
          paginator="true"
          resizableColumns="true"
          paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
          currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
          rowsPerPageTemplate="5,10,{ShowAll|'All'}">
          <p:column headerText="No" sortBy="#{c.encounterNumber}" width="40">
            <h:outputLabel value="#{n+1}"></h:outputLabel>
          </p:column>
          <p:column headerText="ID" sortBy="#{c.id}" filterBy="#{c.id}" filterMatchMode="contains">
            <h:outputLabel value="#{c.id}"></h:outputLabel>
          </p:column>
          <p:column headerText="Tube No" sortBy="#{c.encounterNumber}" filterBy="#{c.encounterNumber}"
            filterMatchMode="contains">
            <h:outputLabel value="#{c.encounterNumber}"></h:outputLabel>
          </p:column>
          <p:column headerText="Lab No" sortBy="#{c.labNumber}" filterBy="#{c.labNumber}" filterMatchMode="contains">
            <h:outputLabel value="#{c.labNumber}"></h:outputLabel>
          </p:column>
          <p:column headerText="Name" sortBy="#{c.client.person.name}" filterBy="#{c.client.person.name}"
            filterMatchMode="contains">
            <h:outputLabel value="#{c.client.person.name}"></h:outputLabel>
          </p:column>
          <p:column headerText="NIC" sortBy="#{c.client.person.nic}" filterBy="#{c.client.person.nic}"
            filterMatchMode="contains">
            <h:outputLabel value="#{c.client.person.nic}"></h:outputLabel>
          </p:column>
          <p:column headerText="Gender" sortBy="#{c.encounterNumber}" filterBy="#{c.client.person.sex.name}"
            filterMatchMode="contains">
            <h:outputLabel value="#{c.client.person.sex.name}"></h:outputLabel>
          </p:column>
          <p:column headerText="Age" sortBy="#{c.client.person.age}" filterBy="#{c.client.person.age}"
            filterMatchMode="contains">
            <h:outputLabel value="#{c.client.person.age}"></h:outputLabel>
          </p:column>
          <p:column headerText="Result" sortBy="#{c.client.person.age}">
            <h:outputLabel value="#{c.pcrResult.name}"></h:outputLabel>
          </p:column>
          <p:column headerText="CT Value 1" soryBy="#{c.ctvalue}">
            <h:outputLabel value="#{c.ctvalue}"></h:outputLabel>
          </p:column>
          <p:column headerText="CT Value 2" sortBy="#{c.ctvalue2}">
            <h:outputLabel value="#{c.ctvalue2}"></h:outputLabel>
          </p:column>
          <p:column headerText="Ordered" sortBy="#{c.createdAt}">
            <h:outputLabel value="#{c.createdAt}">
              <f:convertDateTime pattern="dd MM yy hh:mm"></f:convertDateTime>
            </h:outputLabel>
            <h:outputLabel value=" by ">
            </h:outputLabel>
            <h:outputLabel value="#{c.createdBy.person.name}">
            </h:outputLabel>
          </p:column>
          <p:column headerText="Received" sortBy="#{c.receivedAtLabAt}">
            <h:outputLabel value="Not yet received." rendered="#{c.receivedAtLabAt eq null}">
            </h:outputLabel>
            <h:outputLabel value="#{c.receivedAtLabAt}" rendered="#{c.receivedAtLabAt ne null}">
              <f:convertDateTime pattern="dd MM yy hh:mm"></f:convertDateTime>
            </h:outputLabel>
            <h:outputLabel value=" by #{c.receivedAtLabBy.person.name}" rendered="#{c.receivedAtLabAt ne null}">
            </h:outputLabel>
          </p:column>
          <p:column headerText="Result Entered" sortBy="#{c.resultEnteredAt}">
            <h:outputLabel value="#{c.resultEnteredAt}">
              <f:convertDateTime pattern="dd MM yy hh:mm"></f:convertDateTime>
            </h:outputLabel>
            <h:outputLabel value=" by #{c.resultEnteredBy.person.name}"></h:outputLabel>

          </p:column>
          <p:column headerText="Review">
            <h:outputLabel value="#{c.resultReviewedAt}">
              <f:convertDateTime pattern="dd MM yy hh:mm"></f:convertDateTime>
            </h:outputLabel>
            <h:outputLabel value=" by #{c.resultReviewedBy.person.name}"></h:outputLabel>

          </p:column>
          <p:column headerText="Approved" sortBy="#{c.resultConfirmedAt}">
            <h:outputLabel value="#{c.resultConfirmedAt}">
              <f:convertDateTime pattern="dd MM yy hh:mm"></f:convertDateTime>
            </h:outputLabel>
            <h:outputLabel value=" by #{c.resultConfirmedBy.person.name}"></h:outputLabel>
          </p:column>
          <p:column headerText="Result Viewed" sortBy="#{c.resultNotedAt}">
            <h:outputLabel value="#{c.resultNotedAt}">
              <f:convertDateTime pattern="dd MM yy hh:mm"></f:convertDateTime>
            </h:outputLabel>
          </p:column>

        </p:dataTable>

      </div>

    </ui:define>
  </ui:composition>

</body>

</html>